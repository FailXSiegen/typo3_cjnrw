<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
	  xmlns:n="http://typo3.org/ns/GeorgRinger/News/ViewHelpers"
	  data-namespace-typo3-fluid="true">

<f:layout name="Detail" />
<f:section name="content">
	<f:if condition="{newsItem}">
		<n:format.nothing>
			<n:excludeDisplayedNews newsItem="{newsItem}" />
			<f:if condition="{settings.detail.showMetaTags}">
				<f:render partial="Detail/Opengraph" arguments="{newsItem: newsItem, settings:settings}" />
			</f:if>
            <f:if condition="{newsItem.alternativeTitle}">
                <f:then>
                    <n:titleTag>
                        <f:format.htmlentitiesDecode>{newsItem.alternativeTitle}</f:format.htmlentitiesDecode>
                    </n:titleTag>
                </f:then>
                <f:else>
                    <n:titleTag>
                        <f:format.htmlentitiesDecode>{newsItem.title}</f:format.htmlentitiesDecode>
                    </n:titleTag>
                </f:else>
            </f:if>

		</n:format.nothing>

		<f:comment><!-- GLightbox Assets --></f:comment>
		<f:asset.css
			identifier="glightbox"
			href="EXT:chorstiftung/Resources/Public/StyleSheet/glightboxcss.css" />
		<f:asset.script
			identifier="glightbox-lib"
			src="EXT:chorstiftung/Resources/Public/JavaScript/glightbox.min.js" />
		<f:asset.script identifier="glightbox-init">
			document.addEventListener('DOMContentLoaded', function() {
				const lightbox = GLightbox({
					touchNavigation: true,
					loop: true,
					autoplayVideos: true
				});
			});
		</f:asset.script>


		<f:if condition="{newsItem.mediaNonPreviews}">
			<f:then>
				<f:render section="headline" arguments="{_all}" />

				<f:variable name="imageCount" value="{newsItem.mediaNonPreviews -> f:count()}" />

				<!-- Image Gallery with main image and thumbnails -->
				<div class="row">
					<div class="col-md-8">
						<f:render section="inner-content" arguments="{_all}" />
					</div>
					<div class="col-md-4">
						<f:if condition="{newsItem.mediaNonPreviews}">
							<!-- Main Image -->
							<f:variable name="mainImage" value="{newsItem.mediaNonPreviews.0}" />
							<div class="mb-3">
								<a href="{mainImage.originalResource.publicUrl}"
								   class="glightbox d-block"
								   data-gallery="news-gallery-{newsItem.uid}"
								   <f:if condition="{mainImage.description}">data-description="{mainImage.description -> f:format.htmlspecialchars()}"</f:if>>
									<f:render partial="Media/Rendering/Image" arguments="{file: mainImage, dimensions: {width: '600m'}, class: 'img-fluid rounded shadow'}" />
								</a>
								<f:if condition="{mainImage.description}">
									<small class="text-muted d-block mt-2">{mainImage.description}</small>
								</f:if>
							</div>

							<!-- Thumbnails for additional images -->
							<f:if condition="{imageCount} > 2">
								<f:then>
									<div class="row g-2">
										<f:for each="{newsItem.mediaNonPreviews}" as="mediaElement" iteration="iterator">
											<f:if condition="{iterator.index} > 0">
												<div class="col-4">
													<a href="{mediaElement.originalResource.publicUrl}"
													class="glightbox d-block"
													data-gallery="news-gallery-{newsItem.uid}"
													<f:if condition="{mediaElement.description}">data-description="{mediaElement.description -> f:format.htmlspecialchars()}"</f:if>>
														<f:image
															image="{mediaElement}"
															width="200c"
															height="200c"
															class="img-fluid rounded shadow-sm"
															alt="{mediaElement.alternative}"
															title="{mediaElement.title}" />
													</a>
												</div>
											</f:if>
										</f:for>
									</div>
								</f:then>
								<f:else>
									<f:for each="{newsItem.mediaNonPreviews}" as="mediaElement" iteration="iterator">
										<f:if condition="{iterator.index} > 0">
											<div class="mb-3">
											<a href="{mediaElement.originalResource.publicUrl}"
												class="glightbox d-block"
												data-gallery="news-gallery-{newsItem.uid}"
												<f:if condition="{mediaElement.description}">data-description="{mediaElement.description -> f:format.htmlspecialchars()}"</f:if>>
													<f:render partial="Media/Rendering/Image" arguments="{file: mediaElement, dimensions: {width: '600m'}, class: 'img-fluid rounded shadow'}" />
												</a>
											</div>
										</f:if>
									</f:for>
								</f:else>
							</f:if>
						</f:if>
					</div>
				</div>
			</f:then>
			<f:else>
				<f:render section="headline" arguments="{_all}" />
				<f:render section="inner-content" arguments="{_all}" />
			</f:else>
		</f:if>
	</f:if>
</f:section>

<f:section name="headline">
	<div class="mb-4">
		<h1 class="display-5 fw-bold mb-3" itemprop="headline">{newsItem.title}</h1>
		<f:render partial="General/AdditionalInformation" arguments="{settings:settings,newsItem:newsItem}" />
	</div>
</f:section>

<f:section name="inner-content">
	<n:renderMedia news="{newsItem}" imgClass="img-fluid" videoClass="video-wrapper" audioClass="audio-wrapper">
	

		<f:if condition="{newsItem.contentElements}">
			<f:then>
				<!-- content elements -->
				<f:cObject typoscriptObjectPath="lib.tx_news.contentElementRendering">{newsItem.contentElementIdList}</f:cObject>
			</f:then>
			<f:else>
				<f:if condition="{newsItem.teaser}">
					<!-- teaser -->
					<div class="lead" itemprop="description">
						<f:format.html>{newsItem.teaser}</f:format.html>
					</div>
				</f:if>
			</f:else>
		</f:if>

		<!-- main text -->
		<div class="news-text-wrap" itemprop="articleBody">
			<f:format.html>{newsItem.bodytext}</f:format.html>
		</div>
	</n:renderMedia>

	<f:if condition="{settings.backPid}">
		<!-- Link Back -->
		<f:link.page class="btn btn-primary mb-3" pageUid="{settings.backPid}">
			<f:translate key="back-link" />
		</f:link.page>
	</f:if>

	<f:if condition="{settings.detail.showSocialShareButtons}">
		<f:comment>
			Care about the privacy of your readers?
			Checkout https://typo3.org/extensions/repository/view/rx_shariff
			and it will be used automatically!
		</f:comment>
		<n:extensionLoaded extensionKey="rx_shariff">
			<f:render partial="Detail/Shariff" />
		</n:extensionLoaded>
	</f:if>


	<f:comment>
		Various options exist to fetch different related information:
		- {newsItem.allRelatedSorted}: all related news, related und related from, sorted by date
		- {newsItem.related}: all related
		- {newsItem.relatedSorted}: all related, sorted by date
		- {newsItem.relatedFrom}: all related from
		- {newsItem.relatedFromSorted}: all related from, sorted by date
	</f:comment>
	<f:if condition="{newsItem.allRelatedSorted}">
		<!-- Related news records -->
		<div class="news-related news-related-news mb-4 mt-5">
			<h4 class="mb-3">
				<f:translate key="related-news" />
			</h4>
			<div class="list-group list-group-flush">
				<f:for each="{newsItem.allRelatedSorted}" as="related">
					<n:link newsItem="{related}" settings="{settings}" title="{related.title}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
						<div>
							<div class="fw-bold">{related.title}</div>
							<small class="text-muted">
								<f:format.date format="{f:translate(key:'dateFormat')}">{related.datetime}</f:format.date>
							</small>
						</div>
						<i class="fas fa-chevron-right"></i>
					</n:link>
				</f:for>
			</div>
		</div>
	</f:if>


	<f:if condition="{newsItem.relatedFiles}">
		<!-- related files -->
		<div class="news-related-files mb-4 mt-4">
			<h4 class="mb-3"><f:translate key="LLL:EXT:news/Resources/Private/Language/locallang.xlf:related-files" default="Downloads" /></h4>
			<div class="row g-3">
				<f:for each="{newsItem.relatedFiles}" as="relatedFile">
					<div class="col-md-6 col-lg-4">
						<div class="card h-100">
							<div class="card-body">
								<a href="{relatedFile.originalResource.publicUrl -> f:format.htmlspecialchars()}" target="_blank" class="text-decoration-none">
									<div class="d-flex align-items-center">
										<div class="me-3">
											<i class="fas fa-file-download fa-2x text-primary"></i>
										</div>
										<div class="flex-grow-1">
											<div class="fw-bold text-dark">
												{relatedFile.originalResource.name}
											</div>
											<small class="text-muted">{relatedFile.originalResource.size -> f:format.bytes()}</small>
										</div>
									</div>
									<f:if condition="{relatedFile.originalResource.description}">
										<div class="mt-2 small text-muted">
											{relatedFile.originalResource.description -> f:format.nl2br()}
										</div>
									</f:if>
								</a>
							</div>
						</div>
					</div>
				</f:for>
			</div>
		</div>
	</f:if>

	<f:if condition="{newsItem.relatedLinks}">
		<!-- Related links -->
		<div class="news-related news-related-links mb-4 mt-4">
			<h4 class="mb-3">
				<f:translate key="related-links" />
			</h4>
			<div class="list-group list-group-flush">
				<f:for each="{newsItem.relatedLinks}" as="relatedLink">
					<f:link.typolink parameter="{relatedLink.uri}" title="{relatedLink.title}" target="{n:targetLink(link:relatedLink.uri)}" class="list-group-item list-group-item-action">
						<div class="d-flex align-items-center">
							<i class="fas fa-external-link-alt me-3 text-primary"></i>
							<div class="flex-grow-1">
								<div class="fw-bold">{f:if(condition: relatedLink.title, then: relatedLink.title, else: relatedLink.uri)}</div>
								<f:if condition="{relatedLink.description}">
									<small class="text-muted">{relatedLink.description}</small>
								</f:if>
							</div>
						</div>
					</f:link.typolink>
				</f:for>
			</div>
		</div>
	</f:if>

	<f:comment><!-- Prev/Next News Navigation --></f:comment>
	<n:simplePrevNext pidList="{newsItem.pid}" news="{newsItem}" as="paginated" sortField="datetime">
		<hr class="my-5">
		<div class="news-navigation">
			<h4 class="mb-4">Weitere News</h4>
			<div class="row g-3">
				<f:if condition="{paginated.prev}">
					<div class="col-md-6">
						<div class="card h-100 shadow-sm">
							<f:if condition="{paginated.prev.mediaPreviews}">
								<n:link newsItem="{paginated.prev}" settings="{settings}" title="{paginated.prev.title}">
									<f:render partial="Media/Rendering/Image" arguments="{file: paginated.prev.mediaPreviews.0, dimensions: {width: '600c', height: '400c'}, class: 'img img-fluid card-img-top'}" />
								</n:link>
							</f:if>
							<div class="card-body d-flex flex-column pt-3">
								<span class="px-3">
									<small class="text-muted">
										<f:format.date format="{f:translate(key:'dateFormat')}">{paginated.prev.datetime}</f:format.date>
									</small>
								</span>
								<span class="h5 card-title fw-bold px-3 py-2">
									<n:link newsItem="{paginated.prev}" settings="{settings}" title="{paginated.prev.title}" class="text-decoration-none text-dark">
										{paginated.prev.title}
									</n:link>
								</span>
								<div class="card-text flex-grow-1 px-3">
									<f:if condition="{paginated.prev.teaser}">
										{paginated.prev.teaser -> f:format.crop(maxCharacters: '150', respectWordBoundaries:'1') -> f:format.html()}
									</f:if>
								</div>
								<div class="mt-3 px-3 pb-3">
									<n:link newsItem="{paginated.prev}" settings="{settings}" class="btn btn-primary text-white" title="{paginated.prev.title}">
										<f:translate key="more-link" />
									</n:link>
								</div>
							</div>
						</div>
					</div>
				</f:if>

				<f:if condition="{paginated.next}">
					<div class="col-md-6 {f:if(condition: '{paginated.prev}', else: 'ms-auto')}">
						<div class="card h-100 shadow-sm">
							<f:if condition="{paginated.next.mediaPreviews}">
								<n:link newsItem="{paginated.next}" settings="{settings}" title="{paginated.next.title}">
									<f:render partial="Media/Rendering/Image" arguments="{file: paginated.next.mediaPreviews.0, dimensions: {width: '600c', height: '400c'}, class: 'img img-fluid card-img-top'}" />
								</n:link>
							</f:if>
							<div class="card-body d-flex flex-column pt-3">
								<span class="px-3">
									<small class="text-muted">
										<f:format.date format="{f:translate(key:'dateFormat')}">{paginated.next.datetime}</f:format.date>
									</small>
								</span>
								<span class="h5 card-title fw-bold px-3 py-2">
									<n:link newsItem="{paginated.next}" settings="{settings}" title="{paginated.next.title}" class="text-decoration-none text-dark">
										{paginated.next.title}
									</n:link>
								</span>
								<div class="card-text flex-grow-1 px-3">
									<f:if condition="{paginated.next.teaser}">
										{paginated.next.teaser -> f:format.crop(maxCharacters: '150', respectWordBoundaries:'1') -> f:format.html()}
									</f:if>
								</div>
								<div class="mt-3 px-3 pb-3">
									<n:link newsItem="{paginated.next}" settings="{settings}" class="btn btn-primary text-white" title="{paginated.next.title}">
										<f:translate key="more-link" />
									</n:link>
								</div>
							</div>
						</div>
					</div>
				</f:if>
			</div>
		</div>
	</n:simplePrevNext>
</f:section>
</html>
