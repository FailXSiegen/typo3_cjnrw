<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
	  xmlns:n="http://typo3.org/ns/GeorgRinger/News/ViewHelpers"
	  data-namespace-typo3-fluid="true">

<f:layout name="Detail" />
<f:section name="content">
	<f:if condition="{newsItem}">
		<n:format.nothing>
			<n:excludeDisplayedNews newsItem="{newsItem}" />
			<f:if condition="{settings.detail.showMetaTags}">
				<f:render partial="Detail/Opengraph" arguments="{newsItem: newsItem, settings:settings}" />
			</f:if>
            <f:if condition="{newsItem.alternativeTitle}">
                <f:then>
                    <n:titleTag>
                        <f:format.htmlentitiesDecode>{newsItem.alternativeTitle}</f:format.htmlentitiesDecode>
                    </n:titleTag>
                </f:then>
                <f:else>
                    <n:titleTag>
                        <f:format.htmlentitiesDecode>{newsItem.title}</f:format.htmlentitiesDecode>
                    </n:titleTag>
                </f:else>
            </f:if>

		</n:format.nothing>

		<f:comment><!-- GLightbox Assets --></f:comment>
		<f:asset.css
			identifier="glightbox"
			href="EXT:chorstiftung/Resources/Public/StyleSheet/glightboxcss.css" />
		<f:asset.script
			identifier="glightbox-lib"
			src="EXT:chorstiftung/Resources/Public/JavaScript/glightbox.min.js" />
		<f:asset.script identifier="glightbox-init">
			document.addEventListener('DOMContentLoaded', function() {
				const lightbox = GLightbox({
					touchNavigation: true,
					loop: true,
					autoplayVideos: true
				});
			});
		</f:asset.script>

		<f:if condition="{settings.detail.showPrevNext}">
			<n:simplePrevNext pidList="{newsItem.pid}" news="{newsItem}" as="paginated" sortField="datetime">
				<f:if condition="{paginated}">
					<nav aria-label="Page navigation">
						<ul class="pagination mt-3 justify-content-center">
							<f:if condition="{paginated.prev}">
								<li class="page-item">
									<n:link newsItem="{paginated.prev}" class="page-link" settings="{settings}">
										<span aria-hidden="true">&laquo;</span> {paginated.prev.title}
									</n:link>
								</li>
							</f:if>
							<f:if condition="{paginated.next}">
								<li class="page-item">
									<n:link newsItem="{paginated.next}" class="page-link" settings="{settings}">
										{paginated.next.title} <span aria-hidden="true">&raquo;</span>
									</n:link>
								</li>
							</f:if>
						</ul>
					</nav>
				</f:if>
			</n:simplePrevNext>
		</f:if>

		<f:if condition="{newsItem.mediaNonPreviews}">
			<f:then>
				<f:render section="headline" arguments="{_all}" />

				<f:variable name="imageCount" value="{newsItem.mediaNonPreviews -> f:count()}" />

				<f:if condition="{imageCount} > 2">
					<f:then>
						<!-- Image Gallery for 3+ images -->
						<div class="news-image-gallery mb-4">
							<div class="row g-3">
								<f:for each="{newsItem.mediaNonPreviews}" as="mediaElement" iteration="iterator">
									<div class="col-md-6 col-lg-4">
										<a href="{mediaElement.originalResource.publicUrl}"
										   class="glightbox d-block"
										   data-gallery="news-gallery-{newsItem.uid}"
										   <f:if condition="{mediaElement.description}">data-description="{mediaElement.description -> f:format.htmlspecialchars()}"</f:if>>
											<div class="ratio ratio-4x3 bg-light rounded overflow-hidden shadow">
												<f:render partial="Media/Rendering/Image" arguments="{file: mediaElement, dimensions: {width: '400c', height: '300c'}, class: 'img-fluid object-fit-cover'}" />
											</div>
											<f:if condition="{mediaElement.description}">
												<small class="text-muted d-block mt-1">{mediaElement.description}</small>
											</f:if>
										</a>
									</div>
								</f:for>
							</div>
						</div>
						<f:render section="inner-content" arguments="{_all}" />
					</f:then>
					<f:else>
						<!-- Sidebar layout for 1-2 images -->
						<div class="row">
							<div class="col-md-8">
								<f:render section="inner-content" arguments="{_all}" />
							</div>
							<div class="col-md-4">
								<f:for each="{newsItem.mediaNonPreviews}" as="mediaElement">
									<div class="mb-3">
										<a href="{mediaElement.originalResource.publicUrl}"
										   class="glightbox d-block"
										   data-gallery="news-gallery-{newsItem.uid}"
										   <f:if condition="{mediaElement.description}">data-description="{mediaElement.description -> f:format.htmlspecialchars()}"</f:if>>
											<f:render partial="Media/Rendering/Image" arguments="{file: mediaElement, dimensions: {width: '400m'}, class: 'img-fluid rounded shadow'}" />
										</a>
										<f:if condition="{mediaElement.description}">
											<small class="text-muted d-block mt-1">{mediaElement.description}</small>
										</f:if>
									</div>
								</f:for>
							</div>
						</div>
					</f:else>
				</f:if>
			</f:then>
			<f:else>
				<f:render section="headline" arguments="{_all}" />
				<f:render section="inner-content" arguments="{_all}" />
			</f:else>
		</f:if>
	</f:if>
</f:section>

<f:section name="headline">
	<div class="mb-4">
		<h1 class="display-5 fw-bold mb-3" itemprop="headline">{newsItem.title}</h1>
		<f:render partial="General/AdditionalInformation" arguments="{settings:settings,newsItem:newsItem}" />
	</div>
</f:section>

<f:section name="inner-content">
	<n:renderMedia news="{newsItem}" imgClass="img-fluid" videoClass="video-wrapper" audioClass="audio-wrapper">
	

		<f:if condition="{newsItem.contentElements}">
			<f:then>
				<!-- content elements -->
				<f:cObject typoscriptObjectPath="lib.tx_news.contentElementRendering">{newsItem.contentElementIdList}</f:cObject>
			</f:then>
			<f:else>
				<f:if condition="{newsItem.teaser}">
					<!-- teaser -->
					<div class="lead" itemprop="description">
						<f:format.html>{newsItem.teaser}</f:format.html>
					</div>
				</f:if>
			</f:else>
		</f:if>

		<!-- main text -->
		<div class="news-text-wrap" itemprop="articleBody">
			<f:format.html>{newsItem.bodytext}</f:format.html>
		</div>
	</n:renderMedia>

	<f:if condition="{settings.backPid}">
		<!-- Link Back -->
		<f:link.page class="btn btn-primary mb-3" pageUid="{settings.backPid}">
			<f:translate key="back-link" />
		</f:link.page>
	</f:if>

	<f:if condition="{settings.detail.showSocialShareButtons}">
		<f:comment>
			Care about the privacy of your readers?
			Checkout https://typo3.org/extensions/repository/view/rx_shariff
			and it will be used automatically!
		</f:comment>
		<n:extensionLoaded extensionKey="rx_shariff">
			<f:render partial="Detail/Shariff" />
		</n:extensionLoaded>
	</f:if>


	<f:comment>
		Various options exist to fetch different related information:
		- {newsItem.allRelatedSorted}: all related news, related und related from, sorted by date
		- {newsItem.related}: all related
		- {newsItem.relatedSorted}: all related, sorted by date
		- {newsItem.relatedFrom}: all related from
		- {newsItem.relatedFromSorted}: all related from, sorted by date
	</f:comment>
	<f:if condition="{newsItem.allRelatedSorted}">
		<!-- Related news records -->
		<div class="news-related news-related-news mb-4 mt-5">
			<h4 class="mb-3">
				<f:translate key="related-news" />
			</h4>
			<div class="list-group list-group-flush">
				<f:for each="{newsItem.allRelatedSorted}" as="related">
					<n:link newsItem="{related}" settings="{settings}" title="{related.title}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
						<div>
							<div class="fw-bold">{related.title}</div>
							<small class="text-muted">
								<f:format.date format="{f:translate(key:'dateFormat')}">{related.datetime}</f:format.date>
							</small>
						</div>
						<i class="fas fa-chevron-right"></i>
					</n:link>
				</f:for>
			</div>
		</div>
	</f:if>


	<f:if condition="{newsItem.relatedFiles}">
		<!-- related files -->
		<div class="news-related-files mb-4 mt-4">
			<h4 class="mb-3"><f:translate key="LLL:EXT:news/Resources/Private/Language/locallang.xlf:related-files" default="Downloads" /></h4>
			<div class="row g-3">
				<f:for each="{newsItem.relatedFiles}" as="relatedFile">
					<div class="col-md-6 col-lg-4">
						<div class="card h-100">
							<div class="card-body">
								<a href="{relatedFile.originalResource.publicUrl -> f:format.htmlspecialchars()}" target="_blank" class="text-decoration-none">
									<div class="d-flex align-items-center">
										<div class="me-3">
											<i class="fas fa-file-download fa-2x text-primary"></i>
										</div>
										<div class="flex-grow-1">
											<div class="fw-bold text-dark">
												{relatedFile.originalResource.name}
											</div>
											<small class="text-muted">{relatedFile.originalResource.size -> f:format.bytes()}</small>
										</div>
									</div>
									<f:if condition="{relatedFile.originalResource.description}">
										<div class="mt-2 small text-muted">
											{relatedFile.originalResource.description -> f:format.nl2br()}
										</div>
									</f:if>
								</a>
							</div>
						</div>
					</div>
				</f:for>
			</div>
		</div>
	</f:if>

	<f:if condition="{newsItem.relatedLinks}">
		<!-- Related links -->
		<div class="news-related news-related-links mb-4 mt-4">
			<h4 class="mb-3">
				<f:translate key="related-links" />
			</h4>
			<div class="list-group list-group-flush">
				<f:for each="{newsItem.relatedLinks}" as="relatedLink">
					<f:link.typolink parameter="{relatedLink.uri}" title="{relatedLink.title}" target="{n:targetLink(link:relatedLink.uri)}" class="list-group-item list-group-item-action">
						<div class="d-flex align-items-center">
							<i class="fas fa-external-link-alt me-3 text-primary"></i>
							<div class="flex-grow-1">
								<div class="fw-bold">{f:if(condition: relatedLink.title, then: relatedLink.title, else: relatedLink.uri)}</div>
								<f:if condition="{relatedLink.description}">
									<small class="text-muted">{relatedLink.description}</small>
								</f:if>
							</div>
						</div>
					</f:link.typolink>
				</f:for>
			</div>
		</div>
	</f:if>
</f:section>
</html>
